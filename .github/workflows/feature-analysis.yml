# Workflow pour les branches de feature - analyses légères
name: Feature Branch Security Analysis

on:
  workflow_call:
    inputs:
      frameworks:
        required: true
        type: string
      angular_version:
        required: false
        type: string
      node_version:
        required: false
        type: string
    secrets:
      SONAR_TOKEN:
        required: true
      SONAR_HOST_URL:
        required: true

permissions:
  contents: read
  issues: write
  actions: read
  security-events: write


jobs:
  # Analyse des dépendances (rapide)
  dependency-check:
    name: 📦 Dependency Analysis
    uses: ./.github/workflows/dependency-check.yml

  npm-audit:
  # You may pin to the exact commit or the version.
    name: Audit packages
    runs-on: ubuntu-latest
    steps:
      - uses: luisfontes19/npm-audit-action@v0.1.0
      
            

  

  # Notification rapide en cas de problème
  feature-summary:
    name: 📋 Feature Analysis Summary
    runs-on: ubuntu-latest
    needs: [dependency-check]
    if: always()
    steps:
      - name: Analysis Summary
        run: |
          echo "🔧 Feature Branch Analysis Complete"
          echo "📦 Dependency Check: ${{ needs.dependency-check.result }}"
          
          if [[ "${{ needs.dependency-check.result }}" == "failure"]]; then
            echo "⚠️ Some analyses failed - check logs for details"
            exit 1
          else
            echo "✅ All analyses passed successfully"
          fi
