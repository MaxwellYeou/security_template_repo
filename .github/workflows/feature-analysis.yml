# Workflow pour les branches de feature - analyses lÃ©gÃ¨res
name: Feature Branch Security Analysis

on:
  workflow_call:
    inputs:
      frameworks:
        required: true
        type: string
      angular_version:
        required: false
        type: string
      node_version:
        required: false
        type: string
    secrets:
      SONAR_TOKEN:
        required: true
      SONAR_HOST_URL:
        required: true

permissions:
  contents: read
  issues: write

jobs:
  # Analyse des dÃ©pendances (rapide)
  dependency-check:
    name: ğŸ“¦ Dependency Analysis
    uses: ./.github/workflows/dependency-check.yml

  # Analyse SonarQube (qualitÃ© du code)
  sonar-analysis:
    name: ğŸ” Code Quality Analysis  
    uses: ./.github/workflows/sonar-scan.yml
    secrets:
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

  # Notification rapide en cas de problÃ¨me
  feature-summary:
    name: ğŸ“‹ Feature Analysis Summary
    runs-on: ubuntu-latest
    needs: [dependency-check, sonar-analysis]
    if: always()
    steps:
      - name: Analysis Summary
        run: |
          echo "ğŸ”§ Feature Branch Analysis Complete"
          echo "ğŸ“¦ Dependency Check: ${{ needs.dependency-check.result }}"
          echo "ğŸ” SonarQube Analysis: ${{ needs.sonar-analysis.result }}"
          
          if [[ "${{ needs.dependency-check.result }}" == "failure" || "${{ needs.sonar-analysis.result }}" == "failure" ]]; then
            echo "âš ï¸ Some analyses failed - check logs for details"
            exit 1
          else
            echo "âœ… All analyses passed successfully"
          fi
