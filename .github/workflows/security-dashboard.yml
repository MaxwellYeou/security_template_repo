# Workflow de tableau de bord sÃ©curitÃ© - Vue d'ensemble hebdomadaire
name: Security Dashboard

on:
  schedule:
    - cron: '0 8 * * 1'  # Chaque lundi Ã  8h UTC
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  generate-security-dashboard:
    name: ğŸ“Š Generate Security Dashboard
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Analyze security trends
        run: |
          echo "ğŸ“Š Generating security dashboard..."
          
          # RÃ©cupÃ©rer les informations des derniÃ¨res analyses
          current_date=$(date -u +"%Y-%m-%d")
          week_ago=$(date -u -d '7 days ago' +"%Y-%m-%d")
          
          cat > security-dashboard.md << EOF
          # ğŸ“Š Security Dashboard - Week of $current_date
          
          ## ğŸ¯ Executive Summary
          
          This weekly security dashboard provides an overview of the security posture across all branches and environments.
          
          ## ğŸ—ï¸ Branch Security Status
          
          ### ğŸš€ Production (main branch)
          - **Last Scan**: $(git log -1 --format="%cd" --date=short main 2>/dev/null || echo "No commits")
          - **Status**: $(git log -1 --oneline main 2>/dev/null | head -1 || echo "No commits")
          - **Security Level**: Production Ready âœ…
          
          ### ğŸ§ª Development (dev_test branch)  
          - **Last Scan**: $(git log -1 --format="%cd" --date=short dev_test 2>/dev/null || echo "No commits")
          - **Status**: $(git log -1 --oneline dev_test 2>/dev/null | head -1 || echo "No commits")
          - **Security Level**: Development Testing ğŸ§ª
          
          ## ğŸ“ˆ Security Metrics (Last 7 Days)
          
          ### ğŸ” Analysis Coverage
          - **Dependency Scans**: Automated on all pushes âœ…
          - **Code Quality**: SonarQube analysis active âœ…
          - **Penetration Testing**: ZAP scans on PR to dev_test âœ…
          - **Compliance Checks**: Production validation active âœ…
          
          ### ğŸ¯ Security Targets
          | Metric | Target | Current | Status |
          |--------|--------|---------|---------|
          | Critical Vulns | 0 | TBD | ğŸ¯ |
          | High Vulns | < 5 | TBD | ğŸ¯ |
          | Code Coverage | > 80% | TBD | ğŸ¯ |
          | Quality Gate | Pass | TBD | ğŸ¯ |
          
          ## ğŸ”„ CI/CD Security Pipeline Status
          
          ### âœ… Active Security Controls
          - **Branch Protection**: Enabled on main and dev_test âœ…
          - **Required Reviews**: Security team approval required âœ…
          - **Automated Scanning**: Multi-layered security analysis âœ…
          - **Issue Tracking**: Automated vulnerability management âœ…
          
          ### ğŸ›¡ï¸ Security Workflow Coverage
          
          | Branch Type | Dependency Check | SonarQube | ZAP Scan | Compliance |
          |-------------|------------------|-----------|----------|------------|
          | Feature Branches | âœ… | âœ… | âŒ | âŒ |
          | PR to dev_test | âœ… | âœ… | âœ… | âŒ |
          | PR to main | âœ… | âœ… | âœ… | âœ… |
          | dev_test | âœ… | âœ… | âœ… | âŒ |
          | main | âœ… | âœ… | âœ… | âœ… |
          
          ## ğŸš¨ Recent Security Issues
          
          _This section would be populated with recent security issues from GitHub Issues API_
          
          ## ğŸ“‹ Weekly Security Checklist
          
          ### ğŸ” Review Actions
          - [ ] Review all critical and high severity vulnerabilities
          - [ ] Check SonarQube quality gates status
          - [ ] Verify
